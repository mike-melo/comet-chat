<html>
<head>
	<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
	<script>

		var Chat = Chat || (function($){
			var chatSocket = new WebSocket("ws://localhost:8080/", "echo-protocol");
                        
			chatSocket.onopen = function (event) {  
                        };

                        chatSocket.onmessage = function(event) {
				console.log($.parseJSON(event.data));
                        };
		
			var constructPayload = function(name, message) {
				var payload = {sender: name, message: message};
				return JSON.stringify(payload);	
			};
	
			var sendMessage = function(name, message) {
				console.log('Sending message: ' + message);
				chatSocket.send(constructPayload(name, message));
			};

			return {sendMessage: sendMessage};
		})(jQuery);
		$(function() {
			$('#message-form').submit(function(e) {
				e.preventDefault();
				Chat.sendMessage($('#name').val(), $('#message').val());
			} );
		});
	</script>
	<style>
		textarea, input#message { 
			display: block;
		}
		
		textarea#chat-window {
			height: 20em;
			width: 20em;
		}
	</style>
</head>
<body>
<label>My name is:</label>
<input id="name" name="name" type="text"></input>
<textarea disabled id="chat-window" name="chat-window"></textarea>
<form name="message-form" id="message-form" action="#" method="post">
	<input id="message" name="message" type="text"></input>
</form>
</body>
</html>
